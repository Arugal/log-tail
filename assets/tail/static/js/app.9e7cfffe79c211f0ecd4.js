webpackJsonp([1],{"7FkC":function(t,e){},"Ime+":function(t,e){},NHnr:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("7+uW"),a={methods:{handleSelect:function(t,e){""===t&&window.open("https://github.com/Arugal/log-tail")}}},s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("header",{staticClass:"grid-content header-color"},[i("el-row",[i("svg",[i("use",{attrs:{"xlink:href":"#icon-tail"}})]),t._v(" "),i("a",{staticClass:"brand",attrs:{href:"#"}},[t._v("tail")])])],1),t._v(" "),i("section",[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{id:"side-nav",xs:24,md:4}},[i("el-menu",{attrs:{"default-active":"1",mode:"vertical",theme:"light",router:""},on:{select:t.handleSelect}},[i("el-menu-item",{attrs:{index:"/"}},[t._v("Catalog")]),t._v(" "),i("el-menu-item",{attrs:{index:""}},[t._v("Help")])],1)],1),t._v(" "),i("el-col",{attrs:{xs:24,md:20}},[i("div",{attrs:{id:"content"}},[i("router-view")],1)])],1)],1),t._v(" "),i("footer")])},staticRenderFns:[]};var l=i("VU/8")(a,s,!1,function(t){i("Ime+")},null,null).exports,o=i("/ocq"),c=i("mvHQ"),r=i.n(c),u=i("162o"),h={name:"tail-log",props:{catalog:null,file:null},data:function(){return{lines:[],tailWebSock:null}},created:function(){this.openTailLog()},beforeDestroy:function(){this.webSocketDest()},methods:{successNotify:function(t){var e=this.$createElement;this.$notify({title:"Success",message:e("i",{style:"color: #67C23A"},t)})},warnNotify:function(t){var e=this.$createElement;this.$notify({title:"Wran",message:e("i",{style:"color: #E6A23C"},t)})},openTailLog:function(){if(null!=this.catalog&&null!=this.file&&""!=this.catalog&&""!=this.file){this.webSocketDest();var t="ws://"+window.location.host+"/api/tail/"+this.catalog+"/"+this.file;this.tailWebSock=new WebSocket(t),this.tailWebSock.onmessage=this.webSocketOnMessage,this.tailWebSock.onopen=this.webSocketOnOpen,this.tailWebSock.onerror=this.webScoketOnError,this.tailWebSock.onclose=this.webScoketClose}},webSocketOnOpen:function(){this.webSocketSendJson({type:0}),this.successNotify("Tail "+this.catalog+" "+this.file+" success")},webScoketOnError:function(){this.warnNotify("Tail "+this.catalog+" "+this.file+" failed")},webSocketOnMessage:function(t){var e=JSON.parse(t.data);switch(e.type){case 0:break;case 1:this.lines.push(e.msg);break;case 2:var i=parseInt(e.msg);i>0&&this.heartBeatSend(i)}},webSocketSendJson:function(t){this.tailWebSock.send(r()(t))},webScoketClose:function(t){this.successNotify("Close "+this.catalog+" "+this.file),console.log("websocket close",t)},heartBeatSend:function(t){var e=this;Object(u.clearInterval)(this._inter),this._inter=Object(u.setInterval)(function(){e.webSocketSendJson({type:2})},1e3*t)},webSocketDest:function(){Object(u.clearInterval)(this._inter),null!=this.tailWebSock&&(this.tailWebSock.close(),this.lines=[],this.tailWebSock=null)}}},f={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-scrollbar",{attrs:{"wrap-class":"list","view-style":"font-weight: bold;","view-class":"view-box",native:!1}},[i("div",[i("ul",{staticClass:"infinite-list"},t._l(t.lines,function(e){return i("li",{staticClass:"infinite-list-item"},[t._v(t._s(e))])}),0)])])],1)},staticRenderFns:[]};var d=i("VU/8")(h,f,!1,function(t){i("Ntjl")},null,null).exports,g={data:function(){return{catalogs:[],dialogTableVisible:!1,lines:[],currentCatalog:null,currentFile:null,tailLogKey:1}},created:function(){this.fetchData()},components:{tailLog:d},methods:{successNotify:function(t){var e=this.$createElement;this.$notify({title:"Success",message:e("i",{style:"color: #67C23A"},t)})},warnNotify:function(t){var e=this.$createElement;this.$notify({title:"Wran",message:e("i",{style:"color: #E6A23C"},t)})},fetchData:function(){var t=this;fetch("/api/catalog",{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(t){return t.json()}).then(function(e){t.catalogs=e,t.successNotify("Get api catalog success")}).catch(function(e){t.warnNotify("Get api catalog failed")})},openTailLog:function(t,e){this.currentCatalog=t,this.currentFile=e,++this.tailLogKey,this.dialogTableVisible=!0},closeTailLog:function(){this.currentCatalog="",this.currentFile="",++this.tailLogKey}}},v={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t._l(t.catalogs,function(e){return i("div",{key:e.catalog},[i("el-card",{staticClass:"box-card"},[i("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[i("span",[t._v(t._s(e.catalog))])]),t._v(" "),i("div",t._l(e.child_file,function(n){return i("el-button",{key:n,attrs:{plain:""},on:{click:function(i){return t.openTailLog(e.catalog,n)}}},[t._v(t._s(n)+"\n        ")])}),1)])],1)}),t._v(" "),i("el-dialog",{attrs:{title:t.currentCatalog+" - "+t.currentFile,visible:t.dialogTableVisible,fullscreen:""},on:{"update:visible":function(e){t.dialogTableVisible=e},closed:t.closeTailLog}},[i("tail-log",{key:t.tailLogKey,attrs:{catalog:t.currentCatalog,file:t.currentFile}})],1)],2)},staticRenderFns:[]};var p=i("VU/8")(g,v,!1,function(t){i("7FkC")},null,null).exports;n.default.use(o.a);var b=new o.a({routes:[{path:"/",name:"Catalog",component:p},{path:"/tail",name:"Taillog",component:d}]}),m=i("zL8q"),w=i.n(m);i("tvR6");n.default.config.productionTip=!1,n.default.use(w.a),new n.default({el:"#app",router:b,components:{App:l},template:"<App/>"})},Ntjl:function(t,e){},tvR6:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.9e7cfffe79c211f0ecd4.js.map